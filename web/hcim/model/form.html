<object class="config" name="hsInit" data="">
    <param name="width" value="800px"/>
</object>

<h2 class="hide-in-tabs">${opt}模型</h2>

<div id="hcim-model-form">
    <object class="config" name="hsForm" data="">
        <param name="loadUrl" value="hcim/Model/Info.act"/>
        <param name="saveUrl" value="hcim/Model/Save.act"/>
        <param name="_fill__choose" value="(hsFillFormChoose)"/>
    </object>
    <form action="" method="POST">
        <input type="hidden" name="id"/>
        <div class="form-group">
            <label class="control-label">所属模块</label>
            <div class="choose-box" data-fn="module_id" data-ft="_choose"></div>
            <button type="button" class="btn btn-default" data-toggle="hsChoose" data-url="hcim/module/select.html">选择模块</button>
        </div>
        <div class="form-group">
            <label class="control-label">模型名称</label>
            <input type="text" name="name" class="form-control" required="required" data-unique="hcim/Model/Unique.act?id={id}"/>
        </div>
        <div class="form-group">
            <label class="control-label">代号</label>
            <input type="text" name="code" class="form-control" data-unique="hcim/Model/Unique.act?id={id}"/>
        </div>
        <div class="form-group">
            <label class="control-label">备注</label>
            <textarea name="note" class="form-control"></textarea>
        </div>
        
        <fieldset class="cols-box">
            <legend class="dropdown-toggle">字段设置 <span class="caret"></span></legend>
            <div class="dropdown-body list-box" style="width: 50em;">
                <table class="table">
                    <thead>
                        <tr>
                            <td class="drap_handle"></td>
                            <td>名称</td>
                            <td style="width: 8em;">代号</td>
                            <td style="width: 5em;">类型</td>
                            <td style="width: 4em;">长度</td>
                            <td style="width: 4em;">精度</td>
                            <td style="width: 4em;">&nbsp;</td>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
                <button type="button" class="add-col btn btn-default">添加字段</button>
            </div>
        </fieldset>
        
        <div>
            <button type="submit" class="ensure btn btn-primary">提交</button>
            <button type="button" class="cancel btn btn-link">取消</button>
        </div>
    </form>
</div>

<style type="text/css">
    #hcim-model-form .list-box tbody td
        {padding: 0;}
    #hcim-model-form .list-box tbody td input,
    #hcim-model-form .list-box tbody td select
        {min-width: 100%; width: 100%; height: 100%; border: 0; margin: 0; padding: 0;}
    #hcim-model-form .list-box tbody td input
        {padding: 0 6px;}
    #hcim-model-form .bg-yellow
        {background: #FFFFEF; padding: 15px 0;}
    #hcim-model-form .cols-box
        {margin-bottom: 2em;}
</style>

<script type="text/javascript">
(function($) {
    var context = $("#hcim-model-form");

    /** 字段设置 **/

    var tab = "a_hcim_model_cols";
    var idx = 0;

    function addCol(col) {
        idx ++;
        var nm = $('<input type="text" name="'+tab+'['+idx+'][name]"/>' );
        var cd = $('<input type="text" name="'+tab+'['+idx+'][code]"/>' );
        var ft = $('<select name="'+tab+'['+idx+'][value_type]">'
                 + '<option value="1">文字</option>'
                 + '<option value="2">数字</option>'
                 + '<option value="3">日期</option>'
                 + '<option value="4">时间</option>'
                 + '<option value="5">日期+时间</option>'
                 + '</select>');
        var fs = $('<input type="number" name="'+tab+'['+idx+'][value_size]" min="1" max="10"/>' );
        var fc = $('<input type="number" name="'+tab+'['+idx+'][value_scale]" min="1" max="9"/>');
        var bt = $('<button type="button" class="del-col btn btn-danger">删除</button>');
        $('<tr></tr>').appendTo(context.find(".cols-box tbody"))
            .append($('<td></td>').append(nm))
            .append($('<td></td>').append(cd))
            .append($('<td></td>').append(ft))
            .append($('<td></td>').append(fs))
            .append($('<td></td>').append(fc))
            .append($('<td></td>').append(bt));
        if (col) {
            nm.val(col.name);
            cd.val(col.code);
            ft.val(col.value_type);
            fs.val(col.value_size);
            fc.val(col.value_scale);
        }
    }

    context.on("loadBack", function(evt, rst) {
        if (rst.info) {
            var a = rst.info.a_hcrm_dataset_cols, i = 0;
            if (a) for (; i < a.length; i ++)
                addCol (a[i]);
        }
    });
    context.on("click", ".add-col", function() {
        addCol();
    });
    context.on("click", ".del-col", function() {
        $(this).closest("tr").remove();
    });

})( jQuery );
</script>